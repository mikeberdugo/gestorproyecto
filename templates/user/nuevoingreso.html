{% extends 'plantilla.html' %}
{% load static %}
{% block id_project %}proyecto.id{% endblock %}
{% block title %} gestion de proyecto  - {{proyecto.name}} {% endblock %}
{% block name %}
    {{proyecto.name}}
{% endblock %}
{% block css %}
    <link rel="stylesheet" href="{% static './css/stilos_kanban.css' %}">

    <style>
        .fechas{
            padding-top: 2px;
            max-width: 300px;
        }

        .costos{
            padding-top: 2px;
            max-width: 300px;
        }

    </style>

{% endblock %}
{% block conten %}
<tg-legacy ng-version="10.0.14"></tg-legacy>
<div tg-navigation-bar="" ng-if="!errorHandling.showingError"></div>
<div ng-if="!errorHandling.showingError">
    <div ng-view="" class="master">
        <tg-create-project-form type="kanban">
            <div class="create-project">
                <div class="tarjeta">
                    <div class="titulo">
                        <h1 class="create-project-title">Ingreso</h1>
                    </div>
                    <form name="projectForm"  class="ng-pristine ng-invalid ng-invalid-required" method="POST" >
                        {% csrf_token %}
                        <div>
                            <fieldset>
                                <label for="tipo-ingreso">Tipo de Ingreso</label>
                                <select id="tipo-ingreso" name="tipo-ingreso">
                                    <option value="" disabled selected>Seleccionar...</option>
                                    <option value="One Time">One Time</option>
                                    <option value="Recurrente1">Recurrente (Fijo)</option>
                                    <option value="Recurrente2">Recurrente (No Fijo)</option>
                                    <option value="Bolsa">Bolsa</option>
                                </select>
                            </fieldset>
                        </div>
                        <fieldset id="recurrente-fijo" style="display: none;">
                            <label for="recurrencia-fija">Recurrencia Fija (meses)</label>
                            <input type="number" id="recurrencia-fija" name="recurrencia-fija">
                        </fieldset>
                        <fieldset id="recurrente-no-fijo" style="display: none;">
                            <label for="recurrencia-no-fija">Recurrencia No Fija</label>
                            <input type="number" id="recurrencia-no-fija" name="recurrencia-no-fija">
                            <div class='costos' id="costos-recurrencia-no-fija"></div>

                            <div class='fechas' id="fechas-planeadas"></div>
                        </fieldset>
                        <fieldset>
                            <label for="fecha-planeada">Fecha Planeada:</label>
                            <input type="date" id="fecha-planeada" name="fecha-planeada" required>
                        </fieldset>
                        <fieldset>
                            <label for="valor-planeado">Valor Planeado:</label>
                            <input type="number" id="valor-planeado" name="valor-planeado" min="0" required>
                        </fieldset>
                        <div>
                            <div class="create-project-action">
                                <a href="{% url 'main:ingresobutton' codigo=proyecto.codigo %}" variant="secondary" type="button" title="Volver" class="btn-small create-project-action-cancel" >Volver</a>
                                <button type="submit" class="btn-small create-project-action-submit" title="Asignar Proyecto">Guardar </button>
                            </div>
                        </div>
                        <br>
                    </form>
                </div>
            </div>
        </tg-create-project-form>
    </div>
</div>
{% endblock %}
{% block scripts %}
    <script src="{% static './js/scripts.js' %}"></script>

<script>
    document.getElementById("tipo-ingreso").addEventListener("change", function() {
        var selectValue = this.value;
        var recurrenteFijoFieldset = document.getElementById("recurrente-fijo");
        var recurrenteNoFijoFieldset = document.getElementById("recurrente-no-fijo");
        var fechaPlaneadaFieldset = document.querySelector("fieldset[id='fecha-planeada']");
        if (selectValue === "Recurrente1") {
            recurrenteFijoFieldset.style.display = "block";
            recurrenteNoFijoFieldset.style.display = "none";
            fechaPlaneadaFieldset.style.display = "block";
        } else if (selectValue === "Recurrente2") {
            recurrenteNoFijoFieldset.style.display = "block";
            recurrenteFijoFieldset.style.display = "none";
            fechaPlaneadaFieldset.style.display = "none";
        } else {
            recurrenteFijoFieldset.style.display = "none";
            recurrenteNoFijoFieldset.style.display = "none";
            fechaPlaneadaFieldset.style.display = "block";
        }
    });
    document.getElementById("recurrencia-no-fija").addEventListener("input", function() {
        var numInputs = parseInt(this.value);
        var costosContainer = document.getElementById("costos-recurrencia-no-fija");
        var fechasContainer = document.getElementById("fechas-planeadas");
        costosContainer.innerHTML = "";
        fechasContainer.innerHTML = "";
        for (var i = 0; i < numInputs; i++) {
            var costoInput = document.createElement("input");
            costoInput.type = "number";
            costoInput.name = "costo-recurrencia-no-fija[]";
            costoInput.placeholder = "Costo " + (i + 1);
            costosContainer.appendChild(costoInput);

            var fechaInput = document.createElement("input");
            fechaInput.type = "date";
            fechaInput.name = "fecha-planeada-recurrencia-no-fija[]";
            fechaInput.placeholder = "Fecha " + (i + 1);
            fechasContainer.appendChild(fechaInput);
        }
    });
</script>

{% endblock %}
