{% extends 'plantilla2.html' %}
{% load static %}
{% block id_project %}proyecto.id{% endblock %}

{% block title %} gestion de proyecto  - {{proyecto.name}} {% endblock %}

{% block name %}
    {{proyecto.name}}
{% endblock %}


{% block css %}
    <link rel="stylesheet" href="{% static './css/theme-taiga.css' %}">
    <link rel="stylesheet" href="{% static './css/nuevoproyecto.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-HA8aIQXlN7sUkuqzGZK8r+4LntXBzPwONCzqOUiD54/1xbS49rI/12py9U3WlRj9WcmWlvqzB8lyqbqE2tzBxw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/png" href="http://localhost:9000/v-1708598134890/images/favicon.png">
{% endblock %}

{% block conten %}

    <tg-legacy ng-version="10.0.14"></tg-legacy>
    <div tg-navigation-bar="" ng-if="!errorHandling.showingError">

    </div>
    <div ng-if="!errorHandling.showingError">
        <div ng-view="" class="master">
            <tg-create-project-form type="kanban">
                <div class="create-project">
                    <div class="tarjeta">
                        <div class="titulo">
                        <h1  class="create-project-title">Proyecto</h1>
                    </div>

                    <form name="projectForm" method="POST">
                            {% csrf_token %}
                            <div>
                                <fieldset>
                                    <label for="project-name">Nombre del Proyecto</label>
                                    <input type="text"  placeholder="Nombre del Proyecto (Requerido)" name="project-name" required="required" aria-required="true"  {% if context.name %}value="{{context.name}}" readonly{% endif %}  >
                                </fieldset>
                            </div>
                            <div>
                                <fieldset>
                                    <label for="project-contract-number">Número del contrato</label>
                                    <input type="text" placeholder="Número del contrato" name="project-contract-number" {% if proyecto.contrato %}value="{{proyecto.contrato}}" readonly{% endif %}  >
                                </fieldset>
                            </div>
                            <div>
                                <fieldset>
                                    <label for="project-contract-object">Objeto del contrato</label>
                                    <input type="text" placeholder="Objeto del contrato" name="project-contract-object" {% if proyecto.objeto %}value="{{proyecto.objeto}}" readonly{% endif %}  >
                                </fieldset>
                            </div>
                            <div>
                                <fieldset>
                                    <label for="project-client">Cliente</label>
                                    <input type="text" placeholder="Nombre del cliente" name="project-client" required="required" aria-required="true"  {% if proyecto.cliente %}value="{{proyecto.cliente}}" readonly{% endif %}  >
                                </fieldset>
                            </div>
                            <div>
                                <fieldset>
                                    <label for="project-value">Valor</label>
                                    <input type="number" placeholder="Valor del proyecto" name="project-value" required="required" aria-required="true" {% if proyecto.valor %}value="{{proyecto.valor}}" readonly{% endif %} >
                                </fieldset>
                            </div>
                            <div>
                                <fieldset>
                                    <label for="project-description">Descripción</label>
                                    <textarea placeholder="Descripción del Proyecto (Requerido)" name="project-description" required="required" aria-required="true"  > {{proyecto.description}}</textarea>
                                </fieldset>
                            </div>
                            <fieldset>
                                <label for="project-type">Programa</label>
                                <select id="project-type" name="project-type">
                                    <option value="Proyectos Integración">Proyectos Integración</option>
                                    <option value="Necesidades entrega operación">Necesidades entrega operación</option>
                                    <option value="Proyectos Producto Propio">Proyectos Producto Propio</option>
                                    <option value="Necesidades">Necesidades</option>
                                </select>
                            </fieldset>
                            <fieldset>
                                <label for="project-category">Categoría</label>
                                <select id="project-category" name="project-category">
                                    <option value="Tipo I - Complejidad Superior">Tipo I - Complejidad Superior </option>
                                    <option value="Tipo II - Alta Complejidad">Tipo II - Alta Complejidad</option>
                                    <option value="Tipo III - Media Complejidad">Tipo III - Media Complejidad</option>
                                    <option value="Tipo IV - Baja Complejidad">Tipo IV - Baja Complejidad</option>
                                </select>
                            </fieldset>

                           <fieldset>
                                <label for="fecha-inicio">Fecha de inicio</label>
                                <input type="date" id="fecha-inicio" name="fecha-inicio" class="ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required" aria-invalid="true" style="width: 90%;">
                            </fieldset>
                            <fieldset>
                                <label for="fecha-finalizacion">Fecha de finalización</label>
                                <input type="date" id="fecha-finalizacion" name="fecha-finalizacion" class="ng-pristine ng-untouched ng-empty ng-invalid ng-invalid-required" aria-invalid="true" style="width: 90%;">
                            </fieldset>

                            <fieldset>
                                <label for="project-leader">Cluster</label>
                                <select id="project-leader" name="project-leader" required>
                                    {% for gluste in gluster %}
                                    <option value="{{gluste.cluster}}"> {{gluste.cluster}} </option>
                                    {% endfor %}
                                </select>
                            </fieldset>

                            <fieldset>
                                <label for="project-group">Grupo</label>
                                <select id="project-group" name="project-group" required>
                                    <!-- Agrega las opciones de grupo aquí -->
                                </select>
                            </fieldset>

                            <div>
                                <fieldset>
                                    <label for="project-contractor-manager">Gerente (contratista)</label>
                                    <input type="text" placeholder="Gerente al cliente" name="project-contractor-manager" required="required" aria-required="true" {% if context.tipo %}value="{{context.tipo}}" readonly{% endif %} >
                                </fieldset>
                            </div>
                            <div>
                                <div class="create-project-action">
                                    <a href="{% url 'main:inicio_administrator' %}" variant="secondary" type="button" title="Volver" class="btn-small create-project-action-cancel">Volver</a>
                                    <button type="submit" class="btn-small create-project-action-submit" title="Asignar Proyecto">Asignar Proyecto</button>
                                </div>
                            </div>
                        </form>

                </div>
            </tg-create-project-form>
        </div>
    </div>
</div>
</div>

{% block scripts %}

    <script>
        var leaderSelect = document.getElementById("project-leader");
        var groupSelect = document.getElementById("project-group");
        var groupOptions = {
            {% for gluste in gluster %}
                "{{ gluste.cluster }}": "{{ gluste.grupo }}",
            {% endfor %}
        };

        function updateProjectGroup() {
            groupSelect.innerHTML = "";
            var selectedLeader = leaderSelect.value;
            var selectedGroup = groupOptions[selectedLeader];
            var option = document.createElement("option");
            option.value = selectedGroup;
            option.textContent = " " + selectedGroup;
            groupSelect.appendChild(option);
        }
        leaderSelect.addEventListener("change", updateProjectGroup);
        updateProjectGroup();

        function validarFormulario() {
            // Obtener referencias a los campos del formulario
            var nombreProyecto = document.getElementById('project-name').value;
            var descripcionProyecto = document.getElementById('project-description').value;
            var fechaInicio = document.getElementById('fecha-inicio').value;
            var fechaFin = document.getElementById('fecha-finalizacion').value;
            var alcance = document.getElementById('project-scope').value;
            var lider = document.getElementById('project-leader').value;
            var grupo = document.getElementById('project-group').value;
            var comentarios = document.getElementById('project-comments').value;

            // Validar que ninguno de los campos esté vacío
            if (nombreProyecto === "" || descripcionProyecto === "" || alcance === "" || lider === "" || grupo === "" || comentarios === "") {
                // Mostrar un mensaje de error si algún campo está vacío
                alert("Por favor, complete todos los campos del formulario.");
                // Evitar que se realice la publicación del formulario
                return false;
            }

            // Validar las fechas solo si no están vacías
            if (fechaInicio !== "" && fechaFin !== "") {
                if (new Date(fechaFin) < new Date(fechaInicio)) {
                    alert("La fecha de fin no puede ser anterior a la fecha de inicio.");
                    return false;
                }
            }

            return true;
        }

        const startDateInput = document.getElementById('fecha-inicio');
        const endDateInput = document.getElementById('fecha-finalizacion');

        startDateInput.addEventListener('change', function () {
            const selectedStartDate = new Date(this.value);
            const nextDay = new Date(selectedStartDate);
            nextDay.setDate(selectedStartDate.getDate() + 1); // Agregar 1 día

            const endDateMin = nextDay.toISOString().split('T')[0];
            endDateInput.min = endDateMin;
        });
    </script>

{% endblock %}

{% endblock %}
