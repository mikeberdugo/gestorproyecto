{% extends 'plantilla.html' %}
{% load static %}
{% block id_project %}proyecto.id{% endblock %}

{% block title %} gestion de proyecto  - {{proyecto.name}} {% endblock %}
{% block name %}
    {{proyecto.name}}
{% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static './css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static './css/stilos_kanban.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.1/css/dataTables.tailwindcss.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.9.2/semantic.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.0.2/css/dataTables.semanticui.css"
    />
    <link rel="stylesheet" href="{% static './css/colores.css' %}">

    <style>
        #tabla_riesgos2 tbody td {
        max-width: 100px; /* Establece el ancho máximo deseado */
        white-space: nowrap; /* Evita que el texto se envuelva */
        overflow: hidden; /* Oculta el contenido que excede el ancho máximo */
        text-overflow: ellipsis; /* Agrega puntos suspensivos (...) al final del texto que excede el ancho máximo */

    }
    </style>



{% endblock %}

{% block conten %}
<br>
<div class="content-matriz">

    <div class="container">
        <a href="{% url 'main:nuevomatriz' codigo=proyecto.codigo %}" class="btn btn-info">Agregar Más</a>
    </div>

    <table id="tabla_riesgos" class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>Nombre del riesgo</th>
                <th>Probabilidad</th>
                <th>Gravedad impacto</th>
                <th>Valor riesgo</th>
                <th>Nivel riesgo</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for riesgo in riesgos %}
            <tr>
                <td>{{riesgo.nombre}}</td>
                <td>{{riesgo.probavilidad}}</td>
                <td>{{riesgo.gravedad}}</td>
                <td id="producto_{{ forloop.counter }}"  ></td>
                <td>{{riesgo.riesgo}}</td>
                <td><span class="colorestado"></span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <h2>Más información sobre los riesgos</h2>
    <table id="tabla_riesgos2" class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>Nombre del Riesgo</th>
                <th>Descripción</th>
                <th>Causas</th>
                <th>Plan</th>
                <th>Descripción Tiempo</th>
                <th>Descripción Alcance</th>
                <th>Descripción Costo</th>
                <th>Materializó</th>
                <th>Acciones de Mitigación</th>
                <th>Consecuencias</th>
                <th>Editar</th>
            </tr>
        </thead>
        <tbody>
            {% for riesgo in riesgos %}
            <tr>
                <td>{{riesgo.nombre}}</td>
                <td title="{{riesgo.descripcion}}" >{{riesgo.descripcion}}</td>
                <td title="{{riesgo.causas}}" >{{riesgo.causas}}</td>
                <td title="{{riesgo.plan}}" >{{riesgo.plan}}</td>
                <td title="{{riesgo.descripcion_tiempo}}" >{{riesgo.descripcion_tiempo}}</td>
                <td title="{{riesgo.descripcion_alcance}}" >{{riesgo.descripcion_alcance}}</td>
                <td title="{{riesgo.descripcion_costo}}" >{{riesgo.descripcion_costo}}</td>
                <td title="{{riesgo.materializo}}" >{{riesgo.materializo}}</td>
                <td title="{{riesgo.acciones_mitigacion}}" >{{riesgo.acciones_mitigacion}}</td>
                <td title="{{riesgo.consecuencias}}" >{{riesgo.consecuencias}}</td>
                <td>
                    <a href="{% url 'main:editmatriz' codigo=proyecto.codigo id_riesgo=riesgo.id %}" variant="secondary" type="button" title="Editar" class="btn-small create-project-action-cancel" >
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAPJJREFUSEvFk7EOAUEQhr97AgqRaKm9gMYL0VHRiFCg9EYSb6CSaFUSegk3yRXr7O7s3d7ltt3d75v9Zzah5pXUzCdWsAbewMpVaIxgD8wy8Bw42CRlBR3gAnQN6BLY5CVlBG3gCQyAE9DLoAtgGyuYpJlLpSPgBvSBcxZPdESSt+Qu6w6MgSvQAl6xTZYm7nIQkQyBh2/UQ3pgVm6yjil8qv0jTRAFF7lP4IJLMyWyoOUSVAJ3vaAyuEvwsby9UCzmfVtEeUFpeMgLouDaFAVNiXZI+wfafXW/EYFtitRKjQM/RYdMURH4X18biahoxd7zXwouJhn8uXp/AAAAAElFTkSuQmCC"/>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


</div>


{% endblock %}


{% block scripts %}
    <script src="{% static './js/scripts.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.datatables.net/2.0.2/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.0.2/js/dataTables.tailwindcss.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.9.2/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.9.2/semantic.min.js"></script>
    <script src="{% static './js/colores.js' %}"></script>

    <script>
        $(document).ready(function () {
            var table = $("#tabla_riesgos2").DataTable({
                searching: true,
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",
                },
                autoWidth: true,
                processing: true,
                info: false,
                lengthChange:false,
                scrollX: false,
            });

        });
    </script>

    <script>
    // Calcula el producto de probavilidad y gravedad para cada riesgo y muestra el resultado en la tabla
        {% for riesgo in riesgos %}
        var probavilidad{{ forloop.counter }} = {{ riesgo.probavilidad }};
        var gravedad{{ forloop.counter }} = {{ riesgo.gravedad }};
        var producto{{ forloop.counter }} = probavilidad{{ forloop.counter }} * gravedad{{ forloop.counter }};
        document.getElementById("producto_{{ forloop.counter }}").textContent = producto{{ forloop.counter }};
        {% endfor %}
    </script>
{% endblock %}
