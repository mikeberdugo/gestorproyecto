{% extends 'plantilla.html' %}
{% load static %}

{% block id_project %}{{ proyecto.id }}{% endblock %}

{% block title %} Gestión de proyecto - {{ proyecto.name }} {% endblock %}

{% block name %}
    {{ proyecto.name }}
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static './css/stilos_kanban.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.1/css/dataTables.tailwindcss.css">

    <style>
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        padding: 8px;
        text-align: left;
        border: 1px solid #ddd;
    }
    th {
        background-color: #f2f2f2;
    }
    .botones{
        display: flex;
        margin-top: 12px;
    }
    .boton{
        background-color: #83eede;
        padding: 0.45rem 1rem;
        border-radius: 4px;
    }

    /* Estilos para el modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 5px;
      width: 80%;
      max-width: 500px;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .modal-button {
        background-color: #83eede;
        padding: 0.45rem 1rem;
        border-radius: 4px;
        border: none;
        cursor: pointer;
    }

    </style>

{% endblock %}

{% block conten %}
    <tg-legacy ng-version="10.0.14"></tg-legacy>
    <div tg-navigation-bar="" ng-if="!errorHandling.showingError">

    </div>
    <div ng-if="!errorHandling.showingError">
        <div ng-view="" class="master">
            <tg-create-project-form type="kanban">
                <div class="create-project">
                    <div class="tarjeta">
                        <div class="titulo">
                        <h1  class="create-project-title">Estado financiero</h1>
                    </div>



       <table>
        <tr>
            <th>
                <div class="container">
        <button class="btn-small create-project-action-submit" onclick="document.getElementById('myModal').style.display='block'">Actualizar</button>
    </div>
            </th>
            <th></th>
        </tr>
        <tr>
            <td>código</td>
            <td>{{costos.codigo}}</td>
        </tr>
        <tr>
            <td>Contrato</td>
            <td>{{costos.contrato}}</td>
        </tr>
        <tr>
            <td>Cliente</td>
            <td>{{costos.cliente}}</td>
        </tr>
        <tr>
            <td>Valor total Ingreso</td>
            <td>{{costos.valor_total_ingreso}}</td>
        </tr>
        <tr>
            <td>Costo presupuestado</td>
            <td>{{costos.costo_presupuestado}}</td>
        </tr>
        <tr>
            <td>Utilidad</td>
            <td>{{costos.utilidad}}</td>
        </tr>
        <tr>
            <td>Margen</td>
            <td>{{costos.margen}}</td>
        </tr>
    </table>
    <div class="botones">
        <div class="container">
            <a class="btnAgregar" href="{% url 'main:ingresobutton' codigo=proyecto.codigo %}" >Ingreso</a>
        </div>
        <div class="container">
            <a class="btnAgregar" href="{% url 'main:costobutton' codigo=proyecto.codigo %}" >Costo</a>
        </div>
        <div class="container">
            <a class="btnAgregar" href="{% url 'main:resumenbutton' codigo=proyecto.codigo %}" >Resumen</a>
        </div>
    </div>


                </div>
            </tg-create-project-form>
        </div>
    </div>
</div>
</div>

<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="document.getElementById('myModal').style.display='none'">&times;</span>
    <h2>Complete la información del proyecto</h2>
        <form method="POST">
        {% csrf_token %}
            <label for="id_contrato">Contrato:</label><br>
            <input type="text" id="id_contrato" name="contrato" required><br>

            <label for="id_cliente">Cliente:</label><br>
            <input type="text" id="id_cliente" name="cliente" required><br>

            <label for="id_valor_total_ingreso">Valor Total Ingreso:</label><br>
            <input type="number" id="id_valor_total_ingreso" name="valor_total_ingreso" step="0.01" min="0" required><br>

            <label for="id_costo_presupuestado">Costo Presupuestado:</label><br>
            <input type="number" id="id_costo_presupuestado" name="costo_presupuestado" step="0.01" min="0" required><br>

            <button class="modal-button" type="submit" style="background-color: #83eede;
        padding: 0.45rem 1rem;
        border-radius: 4px;
        border: none;
        cursor: pointer;" >Guardar</button>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static './js/scripts.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.datatables.net/2.0.1/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.0.1/js/dataTables.tailwindcss.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<script>
// Cerrar el modal cuando se hace clic fuera de él
window.onclick = function(event) {
  var modal = document.getElementById('myModal');
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>

<script>
    // función para mostrar los datos en la tabla de colaboradores
    $(document).ready(function () {
        var table = $("#tabla_costos").DataTable({
            searching: true,
            language: {
                url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",
            },
            autoWidth: true,
            processing: true,
            info: false,
            lengthChange: false,
            scrollX: false,
        });
    });



</script>

{% endblock %}